code: |
  
  if (not user.has_lawyer and not user.can_afford) or (not user.has_acting_lawyer):
    user_unrepresented = True
  else:
    user_unrepresented = False

  if user.legal_matter_Alberta and user.lives_Alberta:
    user_resident = True
  else:
    user_resident = False

  if user.had_LAA_assistance or (user_unrepresented and user_resident and (user.has_family_issue or user.has_criminal_issue)):
    user_eligible = True
  else:
    user_eligible = False
---
objects:
  - user: Individual
  - family: DAList.using(object_type=Individual)
---
mandatory: true
question: Results
attachments:
  - Name: Document
    filename: document
    content: |
      
      Advice memo on legal aid eligibility:
      
      Dear ${ user },
      
      You have used Legal Aid Alberta before on an unrelated matter. ${ user.has_prior_issue }.
  
      % if user.has_prior_issue:
      Your prior issue assisted by LAA related to: ${ user.law_area }.
      % endif
      
      % if len(family) > 0:
      You live with the following family members: ${ family }.
      % endif
      
      % if low_income:
      You are considered low income. You get a special discount.
      % else:
      You exceed the low income threshold for the special discount.     
      % endif
      
      % if user_unrepresented:
      You meet the requirements of being unrepresented.
      % else:
      You do not meet the requirements of being unrepresented.
      % endif
      
      % if user_resident:
      You meet the residency requirements.
      % else:
      You do not meet the residency requirements.
      % endif
      
      % if user_eligible:
      You qualify for legal aid services.
      % else:
      You do not qualify for legal aid services.
      % endif
      
      Your birthday is ${ format_date(birthday, format='EEEE, MMMM d, yyyy') }, which can also be written as ${ format_date(birthday, format="yyyy-MM-dd") }.
              
      Your signature: ${ user.signature }
---
generic object: Individual
question: |
  What is ${ x.object_possessive('name') }?
fields: 
  - First Name: x.name.first
  - Last Name: x.name.last
---
question: Do you live with any family members?
yesno: family.there_are_any
---
question: Do you live with other family members?
yesno: family.there_is_another
---
question: Have you used Legal Aid Alberta before on an unrelated matter?
yesno: user.has_prior_issue
---
question: Do you have a lawyer?
yesno: user.has_lawyer
---
question: Can you afford a lawyer?
yesno: user.can_afford
---
question: If you have a lawyer, is that lawyer still acting for you?
yesno: user.has_acting_lawyer
---
question: Is your legal matter located in Alberta?
yesno: user.legal_matter_Alberta
---
question: Is your legal matter a family law matter?
yesno: user.has_family_issue
---
question: Is your legal matter a criminal law matter?
yesno: user.has_criminal_issue
---
question: Do you live in Alberta?
yesno: user.lives_Alberta
---
question: Is your matter an appeal of a matter for which you received LAA assistance?
yesno: user.had_LAA_assistance
---
question: |
  If you had a prior issue assisted by LAA, what did the matter relate to?
field: user.law_area
choices:
  - criminal
  - family
  - not sure
---
question: Do you have a low annual household income relative to the number of people in your household?
yesno: low_income
---
question: What is your birthday?
fields:
  - Birthday: birthday
    datatype: date
---
question: Please sign
signature: user.signature